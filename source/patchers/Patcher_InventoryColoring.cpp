#include "Patcher_InventoryColoring.h"
#include "../Addr.h"
#include "../FileSystem.h"

//-----------------------------------------------------------------------------
// Static variable initialization

int CPatcher_InventoryColoring::strCount;

CPatcher_InventoryColoring::InvStruct CPatcher_InventoryColoring::InvColor[512];

unsigned long CPatcher_InventoryColoring::Color1;
unsigned long CPatcher_InventoryColoring::Color2;

bool CPatcher_InventoryColoring::ColorMOD = false;

LPBYTE CPatcher_InventoryColoring::addrTargetReturn = NULL;
LPBYTE CPatcher_InventoryColoring::addrItemColoring = NULL;

LPBYTE CPatcher_InventoryColoring::addrIsBroken = NULL;
LPBYTE CPatcher_InventoryColoring::addrIsExpired = NULL;
LPBYTE CPatcher_InventoryColoring::addrCheckFastStringID = NULL;

bool CPatcher_InventoryColoring::PatchEnabled = false;
//-----------------------------------------------------------------------------
// Constructor

CPatcher_InventoryColoring::CPatcher_InventoryColoring( void )
{
	patchname = "ÀÎº¥Åä¸® ÄÃ·¯¸µ";

	addrIsExpired = CAddr::Addr(IItem_IsExpired);
	addrIsBroken = CAddr::Addr(IItem_IsBroken);
	addrCheckFastStringID = CAddr::Addr(IItem_CheckFastStringID);

	int count = 0;

	//////////////////////////////////////////////////////////////////
	//																//
	//						Åø ÆÄÆ®									//
	//																//
	//////////////////////////////////////////////////////////////////
	// ¾Ç±â
	wcscpy_s(InvColor[count].category, 256, L"/instrument/");
	wcscpy_s(InvColor[count].name, 256, L"InvInstrument");
	count++;

	// Ã¥
	wcscpy_s(InvColor[count].category, 256, L"/book/");
	wcscpy_s(InvColor[count].name, 256, L"InvBook");
	count++;

	//////////////////////////////////////////////////////////////////
	//																//
	//						Àåºñ ÆÄÆ®								//
	//																//
	//////////////////////////////////////////////////////////////////

	// È­»ìÅë
	wcscpy_s(InvColor[count].category, 256, L"/weapon/arrow/sac_item/largearrowsac/");
	wcscpy_s(InvColor[count].name, 256, L"InvArrowSac");
	count++;

	// È­»ì
	wcscpy_s(InvColor[count].category, 256, L"/weapon/arrow/");
	wcscpy_s(InvColor[count].name, 256, L"InvArrow");
	count++;

	// ¹«±â
	wcscpy_s(InvColor[count].category, 256, L"/weapon/");
	wcscpy_s(InvColor[count].name, 256, L"InvEquipWeapon");
	count++;

	// Á¤·É¹«±â
	wcscpy_s(InvColor[count].category, 256, L"/ego_weapon/");
	wcscpy_s(InvColor[count].name, 256, L"InvEgoWeapon");
	count++;

	// ¹æÆÐ
	wcscpy_s(InvColor[count].category, 256, L"/shield/");
	wcscpy_s(InvColor[count].name, 256, L"InvEquipShield");
	count++;

	// ¾Ç¼¼
	wcscpy_s(InvColor[count].category, 256, L"/accessary/");
	wcscpy_s(InvColor[count].name, 256, L"InvEquipAccessary");
	count++;

	// ¸ðÀÚ
	wcscpy_s(InvColor[count].category, 256, L"/equip/head/");
	wcscpy_s(InvColor[count].name, 256, L"InvEquipHead");
	count++;

	// ¿Ê
	wcscpy_s(InvColor[count].category, 256, L"/cloth/");
	wcscpy_s(InvColor[count].name, 256, L"InvEquipArmor");
	count++;

	// ½Å¹ß
	wcscpy_s(InvColor[count].category, 256, L"/shoes/");
	wcscpy_s(InvColor[count].name, 256, L"InvEquipFoot");
	count++;

	// Àå°©
	wcscpy_s(InvColor[count].category, 256, L"/glove/");
	wcscpy_s(InvColor[count].name, 256, L"InvEquipHand");
	count++;

	// ·Îºê
	wcscpy_s(InvColor[count].category, 256, L"/robe/");
	wcscpy_s(InvColor[count].name, 256, L"InvEquipRobe");
	count++;


	//////////////////////////////////////////////////////////////////
	//																//
	//						 Æ÷¼Ç & Ä¡·á ÆÄÆ®						//
	//																//
	//////////////////////////////////////////////////////////////////

	// Ã¼·Â+¸¶³ª Æ÷¼Ç
	wcscpy_s(InvColor[count].category, 256, L"/usable/potion/mana/hp/");
	wcscpy_s(InvColor[count].name, 256, L"InvHPManaPotion");
	count++;

	// ½ºÅÛ+¸¶³ª Æ÷¼Ç
	wcscpy_s(InvColor[count].category, 256, L"/usable/potion/stamina/hp/");
	wcscpy_s(InvColor[count].name, 256, L"InvStaminaManaPotion");
	count++;

	// »ý¸í·Â Æ÷¼Ç
	wcscpy_s(InvColor[count].category, 256, L"/usable/potion/hp/");
	wcscpy_s(InvColor[count].name, 256, L"InvHPPotion");
	count++;

	// ¸¶³ª Æ÷¼Ç
	wcscpy_s(InvColor[count].category, 256, L"/usable/potion/mana/");
	wcscpy_s(InvColor[count].name, 256, L"InvManaPotion");
	count++;

	// ½ºÅ×¹Ì³ª Æ÷¼Ç
	wcscpy_s(InvColor[count].category, 256, L"/usable/potion/stamina/");
	wcscpy_s(InvColor[count].name, 256, L"InvStaminaPotion");
	count++;

	// ºÎ»ó È¸º¹ Æ÷¼Ç
	wcscpy_s(InvColor[count].category, 256, L"/usable/potion/wound/");
	wcscpy_s(InvColor[count].name, 256, L"InvWoundPotion");
	count++;

	// ¿ÏÀü È¸º¹ Æ÷¼Ç
	wcscpy_s(InvColor[count].category, 256, L"/usable/potion/full_recovery_potion/");
	wcscpy_s(InvColor[count].name, 256, L"InvFullRecoveryPotion");
	count++;

	// Ãàº¹ÀÇ Æ÷¼Ç
	wcscpy_s(InvColor[count].category, 256, L"/usable/blessing/");
	wcscpy_s(InvColor[count].name, 256, L"InvBlessPotion");
	count++;

	// µ¶ Æ÷¼Ç
	wcscpy_s(InvColor[count].category, 256, L"/usable/potion/poison/");
	wcscpy_s(InvColor[count].name, 256, L"InvPoisonPotion");
	count++;

	// ÇØµ¶ Æ÷¼Ç
	wcscpy_s(InvColor[count].category, 256, L"/usable/potion/antidote/");
	wcscpy_s(InvColor[count].name, 256, L"InvAntidotePotion");
	count++;

	// »õµµ¿ì Å©¸®½ºÅ»
	wcscpy_s(InvColor[count].category, 256, L"/usable/potion/no_hotkey/writelog_use/shadow_mission_bonus/not_feed/");
	wcscpy_s(InvColor[count].name, 256, L"InvShadowMissionBonus");
	count++;

	// ±×¿Ü ¸ðµç Á¾·ù Æ÷¼Ç
	wcscpy_s(InvColor[count].category, 256, L"/usable/potion/");
	wcscpy_s(InvColor[count].name, 256, L"InvOtherPotion");
	count++;

	// ±êÅÐ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/usable/resurrection/");
	wcscpy_s(InvColor[count].name, 256, L"InvResurrection");
	count++;

	// ºØ´ë ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/usable/material/tailor/bandage/");
	wcscpy_s(InvColor[count].name, 256, L"InvBandage");
	count++;

	//////////////////////////////////////////////////////////////////
	//																//
	//						¿¤·¹¸àÅ» ÆÄÆ®							//
	//																//
	//////////////////////////////////////////////////////////////////
	
	// ¾ÆÀÌ½º ¿¤·¹¸àÅ»
	wcscpy_s(InvColor[count].category, 256, L"/ice_elemental/");
	wcscpy_s(InvColor[count].name, 256, L"InvIceElemental");
	count++;

	// ÆÄÀÌ¾î ¿¤·¹¸àÅ»
	wcscpy_s(InvColor[count].category, 256, L"/fire_elemental/");
	wcscpy_s(InvColor[count].name, 256, L"InvFireElemental");
	count++;
	
	// ¶óÀÌÆ®´× ¿¤·¹¸àÅ»
	wcscpy_s(InvColor[count].category, 256, L"/lightning_elemental/");
	wcscpy_s(InvColor[count].name, 256, L"InvLightningElemental");
	count++;
	
	// ¿¤·¹¸àÅ» ¸®¹«¹ö
	wcscpy_s(InvColor[count].category, 256, L"/elemental_remover/");
	wcscpy_s(InvColor[count].name, 256, L"InvElementalRemover");
	count++;

	//////////////////////////////////////////////////////////////////
	//																//
	//						 ±¤¼® ÆÄÆ®								//
	//																//
	//////////////////////////////////////////////////////////////////

	// Ã¶±¤¼®
	wcscpy_s(InvColor[count].category, 256, L"/ore/ironore/");
	wcscpy_s(InvColor[count].name, 256, L"InvIronOre");
	count++;
	wcscpy_s(InvColor[count].category, 256, L"/ore/ironore_fragment/");
	wcscpy_s(InvColor[count].name, 256, L"InvIronOre");
	count++;

	// Àº±¤¼®
	wcscpy_s(InvColor[count].category, 256, L"/ore/silverore/");
	wcscpy_s(InvColor[count].name, 256, L"InvSilverOre");
	count++;
	wcscpy_s(InvColor[count].category, 256, L"/ore/silverore_fragment/");
	wcscpy_s(InvColor[count].name, 256, L"InvSilverOre");
	count++;

	// µ¿±¤¼®
	wcscpy_s(InvColor[count].category, 256, L"/ore/copperore/");
	wcscpy_s(InvColor[count].name, 256, L"InvCopperOre");
	count++;
	wcscpy_s(InvColor[count].category, 256, L"/ore/copperore_fragment/");
	wcscpy_s(InvColor[count].name, 256, L"InvCopperOre");
	count++;

	// ±Ý±¤¼®
	wcscpy_s(InvColor[count].category, 256, L"/ore/goldore/");
	wcscpy_s(InvColor[count].name, 256, L"InvGoldOre");
	count++;
	wcscpy_s(InvColor[count].category, 256, L"/ore/goldore_fragment/");
	wcscpy_s(InvColor[count].name, 256, L"InvGoldOre");
	count++;

	// ¹Ì½º¸±±¤¼®
	wcscpy_s(InvColor[count].category, 256, L"/ore/mythrilore/");
	wcscpy_s(InvColor[count].name, 256, L"InvMythrilOre");
	count++;
	wcscpy_s(InvColor[count].category, 256, L"/ore/mythrilore_fragment/");
	wcscpy_s(InvColor[count].name, 256, L"InvMythrilOre");
	count++;

	// StrangeOre
	wcscpy_s(InvColor[count].category, 256, L"/ore/strangeore_fragment/");
	wcscpy_s(InvColor[count].name, 256, L"InvStrangeOre");
	count++;

	// Ã¶±«
	wcscpy_s(InvColor[count].category, 256, L"/ingot/ironingot/");
	wcscpy_s(InvColor[count].name, 256, L"InvIronIngot");
	count++;

	// Àº±«
	wcscpy_s(InvColor[count].category, 256, L"/ingot/silveringot/");
	wcscpy_s(InvColor[count].name, 256, L"InvSilverIngot");
	count++;

	// µ¿±«
	wcscpy_s(InvColor[count].category, 256, L"/ingot/copperingot/");
	wcscpy_s(InvColor[count].name, 256, L"InvCopperIngot");
	count++;

	// ±Ý±«
	wcscpy_s(InvColor[count].category, 256, L"/ingot/goldingot/");
	wcscpy_s(InvColor[count].name, 256, L"InvGoldIngot");
	count++;

	// ¹Ì½º¸±±«
	wcscpy_s(InvColor[count].category, 256, L"/ingot/mythrilingot/");
	wcscpy_s(InvColor[count].name, 256, L"InvMythrilIngot");
	count++;

	// Ã¶ÆÇ
	wcscpy_s(InvColor[count].category, 256, L"/plate/iron/");
	wcscpy_s(InvColor[count].name, 256, L"InvIronPlate");
	count++;

	// ÀºÆÇ
	wcscpy_s(InvColor[count].category, 256, L"/plate/silver/");
	wcscpy_s(InvColor[count].name, 256, L"InvSilverPlate");
	count++;

	// µ¿ÆÇ
	wcscpy_s(InvColor[count].category, 256, L"/plate/copper/");
	wcscpy_s(InvColor[count].name, 256, L"InvCopperPlate");
	count++;

	// ±ÝÆÇ
	wcscpy_s(InvColor[count].category, 256, L"/plate/gold/");
	wcscpy_s(InvColor[count].name, 256, L"InvGoldPlate");
	count++;

	// ¹Ì½º¸±ÆÇ
	wcscpy_s(InvColor[count].category, 256, L"/plate/mythril/");
	wcscpy_s(InvColor[count].name, 256, L"InvMythrilPlate");
	count++;

	// Ã¶ºÀ
	wcscpy_s(InvColor[count].category, 256, L"/bar/iron/");
	wcscpy_s(InvColor[count].name, 256, L"InvIronBar");
	count++;

	// ÀººÀ
	wcscpy_s(InvColor[count].category, 256, L"/bar/silver/");
	wcscpy_s(InvColor[count].name, 256, L"InvSilverBar");
	count++;

	// µ¿ºÀ
	wcscpy_s(InvColor[count].category, 256, L"/bar/copper/");
	wcscpy_s(InvColor[count].name, 256, L"InvCopperBar");
	count++;

	// ±ÝºÀ
	wcscpy_s(InvColor[count].category, 256, L"/bar/gold/");
	wcscpy_s(InvColor[count].name, 256, L"InvGoldBar");
	count++;

	// ¹Ì½º¸±ºÀ
	wcscpy_s(InvColor[count].category, 256, L"/bar/mythril/");
	wcscpy_s(InvColor[count].name, 256, L"InvMythrilBar");
	count++;

	//////////////////////////////////////////////////////////////////
	//																//
	//						ÇÏ¿ìÂ¡ ÆÄÆ®								//
	//																//
	//////////////////////////////////////////////////////////////////

	// ÇÏ¿ìÂ¡ ¿­¼è
	wcscpy_s(InvColor[count].category, 256, L"/usable/warp_scroll/target/house/host_warp/");
	wcscpy_s(InvColor[count].name, 256, L"InvHousingKey");
	count++;

	// ÇÏ¿ìÂ¡ ±ÍÈ¯ ÄíÆù
	wcscpy_s(InvColor[count].category, 256, L"/usable/warp_scroll/target/destroyable/");
	wcscpy_s(InvColor[count].name, 256, L"InvHousingReturnCoupon");
	count++;

	//////////////////////////////////////////////////////////////////
	//																//
	//						´øÀü ÆÄÆ®								//
	//																//
	//////////////////////////////////////////////////////////////////

	// ¸¶Á· ÅëÇàÁõ #g3_pass
	wcscpy_s(InvColor[count].category, 256, L"/item/g3_pass/");
	wcscpy_s(InvColor[count].name, 256, L"InvDungeonPass");
	count++;

	// ¸¶Á· ÅëÇàÁõ #dungeon_pass
	wcscpy_s(InvColor[count].category, 256, L"/item/dungeon_pass/");
	wcscpy_s(InvColor[count].name, 256, L"InvDungeonPass");
	count++;

	// ¸¶Á· ÅëÇàÁõ #unlimited_dungeon_pass
	wcscpy_s(InvColor[count].category, 256, L"/usable/unlimited_dungeon_pass/");
	wcscpy_s(InvColor[count].name, 256, L"InvDungeonPass");
	count++;

	// À¯Àû ÅëÇàÁõ
	wcscpy_s(InvColor[count].category, 256, L"/item/ruin_pass/");
	wcscpy_s(InvColor[count].name, 256, L"InvRuinPass");
	count++;

	// ±×¸²ÀÚ¹Ì¼Ç ÅëÇàÁõ
	wcscpy_s(InvColor[count].category, 256, L"/item/shadowmission_pass/");
	wcscpy_s(InvColor[count].name, 256, L"InvShadowMissionPass");
	count++;

	// ´øÀü Å°
	wcscpy_s(InvColor[count].category, 256, L"/dungeon/key/");
	wcscpy_s(InvColor[count].name, 256, L"InvDungeonKey");
	count++;

	//////////////////////////////////////////////////////////////////
	//																//
	//						È­¼® ÆÄÆ®								//
	//																//
	//////////////////////////////////////////////////////////////////

	// º¹¿ø °¡´ÉÇÑ È­¼®
	wcscpy_s(InvColor[count].category, 256, L"/item/usable/fossil_restoration/");
	wcscpy_s(InvColor[count].name, 256, L"InvFossilRestorable");
	count++;

	// º¹¿øµÈ È­¼®
	wcscpy_s(InvColor[count].category, 256, L"/item/fossil/");
	wcscpy_s(InvColor[count].name, 256, L"InvFossil");
	count++;


	//////////////////////////////////////////////////////////////////
	//																//
	//					 ½ºÅ©·Ñ ¾ÆÀÌÅÛ ÆÄÆ®						//
	//																//
	//////////////////////////////////////////////////////////////////

	// ÀÎÃ¦Æ® ½ºÅ©·Ñ
	wcscpy_s(InvColor[count].category, 256, L"/enchant/enchantscroll/");
	wcscpy_s(InvColor[count].name, 256, L"InvEnchantScroll");
	count++;

	// µµ¸é ½ºÅ©·Ñ
	wcscpy_s(InvColor[count].category, 256, L"/manual/");
	wcscpy_s(InvColor[count].name, 256, L"InvManualScroll");
	count++;

	// Äù½ºÆ® ½ºÅ©·Ñ
	wcscpy_s(InvColor[count].category, 256, L"/scroll/mission_paper/");
	wcscpy_s(InvColor[count].name, 256, L"InvQuestScroll");
	count++;
	wcscpy_s(InvColor[count].category, 256, L"/scroll/questscroll/");
	wcscpy_s(InvColor[count].name, 256, L"InvQuestScroll");
	count++;

	// ¾Çº¸ ½ºÅ©·Ñ
	wcscpy_s(InvColor[count].category, 256, L"/scroll/lefthand/no_abrasion/score/");
	wcscpy_s(InvColor[count].name, 256, L"InvScoreScroll");
	count++;

	// ±× ¿Ü ³ª¸ÓÁö ½ºÅ©·Ñ
	wcscpy_s(InvColor[count].category, 256, L"/scroll/");
	wcscpy_s(InvColor[count].name, 256, L"InvOtherScroll");
	count++;

	//////////////////////////////////////////////////////////////////
	//																//
	//					»ç¿ë°¡´É ¾ÆÀÌÅÛ ÆÄÆ®						//
	//																//
	//////////////////////////////////////////////////////////////////

	// µ·ÁÖ¸Ó´Ï
	wcscpy_s(InvColor[count].category, 256, L"/pouch/money/");
	wcscpy_s(InvColor[count].name, 256, L"InvMoneyPouch");
	count++;

	// °ñµå
	wcscpy_s(InvColor[count].category, 256, L"/money/not_given/");
	wcscpy_s(InvColor[count].name, 256, L"InvGoldMoney");
	count++;

	// ¾çÅÐ ÁÖ¸Ó´Ï
	wcscpy_s(InvColor[count].category, 256, L"/sac_item/woolsac/not_given/");
	wcscpy_s(InvColor[count].name, 256, L"InvWoolSac");
	count++;

	// ½ÄÇ°
	wcscpy_s(InvColor[count].category, 256, L"/usable/food/");
	wcscpy_s(InvColor[count].name, 256, L"InvUsableFood");
	count++;

	// ³¯°³ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/usable/warp_scroll/");
	wcscpy_s(InvColor[count].name, 256, L"InvWarpWing");
	count++;

	// ¾ÆÀÌ½º ¸¶ÀÎ
	wcscpy_s(InvColor[count].category, 256, L"/usable/mine/ice/");
	wcscpy_s(InvColor[count].name, 256, L"InvIceMine");
	count++;

	// °³ÀÎ »óÁ¡ Çã°¡Áõ
	wcscpy_s(InvColor[count].category, 256, L"/usable/personalshoplicense/");
	wcscpy_s(InvColor[count].name, 256, L"InvPersonalShopLicense");
	count++;

	//////////////////////////////////////////////////////////////////
	//																//
	//						°áÁ¤ ¾ÆÀÌÅÛ ÆÄÆ®						//
	//																//
	//////////////////////////////////////////////////////////////////

	// ±¸¸§ÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/usable/crystal/cloud/");
	wcscpy_s(InvColor[count].name, 256, L"InvCloudCrystal");
	count++;

	// ´«º¸¶óÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/usable/crystal/snowstorm/");
	wcscpy_s(InvColor[count].name, 256, L"InvSnowStormCrystal");
	count++;

	// ¹æÈ£º®ÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/usable/crystal/barrier/");
	wcscpy_s(InvColor[count].name, 256, L"InvBarrierCrystal");
	count++;

	// ºÒÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/fire_crystal/crystal/");
	wcscpy_s(InvColor[count].name, 256, L"InvFireCrystal");
	count++;

	// ¹°ÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/water_crystal/crystal/");
	wcscpy_s(InvColor[count].name, 256, L"InvWaterCrystal");
	count++;

	// ¹Ù¶÷ÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/wind_crystal/crystal/");
	wcscpy_s(InvColor[count].name, 256, L"InvWindCrystal");
	count++;

	// ¶¥ÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/earth_crystal/crystal/");
	wcscpy_s(InvColor[count].name, 256, L"InvEarthCrystal");
	count++;

	// ÆÄÀÌ¾îº¼ÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/usable/item/crystal/mana_forming/hotkey_bar/fireball_crystal/");
	wcscpy_s(InvColor[count].name, 256, L"InvFireBallCrystal");
	count++;

	// ¾ÆÀÌ½º ½ºÇÇ¾îÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/usable/item/crystal/mana_forming/hotkey_bar/icespear_crystal/");
	wcscpy_s(InvColor[count].name, 256, L"InvIceSpearCrystal");
	count++;

	// ½ã´õÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/usable/item/crystal/mana_forming/hotkey_bar/thunder_crystal/");
	wcscpy_s(InvColor[count].name, 256, L"InvThunderCrystal");
	count++;

	// ¶óÀÌÇÁ µå·¹ÀÎÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/item/crystal/lifedrain/usable/");
	wcscpy_s(InvColor[count].name, 256, L"InvLifeDrainCrystal");
	count++;

	// ¿öÅÍ Ä³³íÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/item/crystal/watercannon/");
	wcscpy_s(InvColor[count].name, 256, L"InvWaterCannonCrystal");
	count++;

	// ¹ÙÀ§ °ñ·½ÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/item/crystal/rockgolem/recall/usable/");
	wcscpy_s(InvColor[count].name, 256, L"InvRockGolemCrystal");
	count++;

	// ½£ °ñ·½ÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/item/crystal/forestgolem/recall/usable/");
	wcscpy_s(InvColor[count].name, 256, L"InvForestGolemCrystal");
	count++;

	// À¯È² °ñ·½ÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/item/crystal/sulfurgolem/recall/usable/");
	wcscpy_s(InvColor[count].name, 256, L"InvSulfurGolemCrystal");
	count++;

	// ¼ø¹é/¸¶¹ý °ñ·½ÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/item/crystal/whitegolem/recall/usable/");
	wcscpy_s(InvColor[count].name, 256, L"InvWhiteGolemCrystal");
	count++;

	// ½ºÆÄÅ©ÀÇ °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/item/crystal/spark/usable/");
	wcscpy_s(InvColor[count].name, 256, L"InvSparkCrystal");
	count++;

	// ±× ¿Ü °áÁ¤ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/crystal/");
	wcscpy_s(InvColor[count].name, 256, L"InvCrystal");
	count++;

	//////////////////////////////////////////////////////////////////
	//																//
	//						Ã¤Áý ¾ÆÀÌÅÛ ÆÄÆ®						//
	//																//
	//////////////////////////////////////////////////////////////////

	// ³ª¹«Åä¸·
	wcscpy_s(InvColor[count].category, 256, L"/item/wood/");
	wcscpy_s(InvColor[count].name, 256, L"InvWoodItem");
	count++;

	// Çãºê
	wcscpy_s(InvColor[count].category, 256, L"/herb/");
	wcscpy_s(InvColor[count].name, 256, L"InvHerbItem");
	count++;

	// º¸¼® ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/jewel/");
	wcscpy_s(InvColor[count].name, 256, L"InvJewel");
	count++;

	//////////////////////////////////////////////////////////////////
	//																//
	//						¼öÁý ¾ÆÀÌÅÛ ÆÄÆ®						//
	//																//
	//////////////////////////////////////////////////////////////////

	// ¸¶Á· ½ºÅ©·Ñ
	wcscpy_s(InvColor[count].category, 256, L"/item/evilscroll/");
	wcscpy_s(InvColor[count].name, 256, L"InvEvilScroll");
	count++;

	// ³ª¿À ¿Ê
	wcscpy_s(InvColor[count].category, 256, L"/item/nao_dress/");
	wcscpy_s(InvColor[count].name, 256, L"InvNaoDress");
	count++;

	//////////////////////////////////////////////////////////////////
	//																//
	//						ÀÏ¹Ý ¾ÆÀÌÅÛ ÆÄÆ®						//
	//																//
	//////////////////////////////////////////////////////////////////

	// ¼±¹° ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/present/");
	wcscpy_s(InvColor[count].name, 256, L"InvGiftItem");
	count++;

	// ¹è´Þ ¾ÆÀÌÅÛ
	wcscpy_s(InvColor[count].category, 256, L"/delivery/");
	wcscpy_s(InvColor[count].name, 256, L"InvDeliveryItem");
	count++;

	// Ä÷¸° ½ºÅæ#01
	wcscpy_s(InvColor[count].category, 256, L"/item/stone01/");
	wcscpy_s(InvColor[count].name, 256, L"InvCuilinStone");
	count++;

	// Ä÷¸° ½ºÅæ#02
	wcscpy_s(InvColor[count].category, 256, L"/item/stone02/");
	wcscpy_s(InvColor[count].name, 256, L"InvCuilinStone");
	count++;

	// Ä÷¸° ½ºÅæ#03
	wcscpy_s(InvColor[count].category, 256, L"/item/stone03/");
	wcscpy_s(InvColor[count].name, 256, L"InvCuilinStone");
	count++;

	// Ä÷¸° ½ºÅæ#04
	wcscpy_s(InvColor[count].category, 256, L"/item/stone04/");
	wcscpy_s(InvColor[count].name, 256, L"InvCuilinStone");
	count++;

	// Á¤·É¼®(¿ø¼®)
	wcscpy_s(InvColor[count].category, 256, L"/item/FragmentSpiritFossil/");
	wcscpy_s(InvColor[count].name, 256, L"InvSpiritFossil");
	count++;

	// Á¤·É¼®
	wcscpy_s(InvColor[count].category, 256, L"/item/ego_stone/");
	wcscpy_s(InvColor[count].name, 256, L"InvEgoStone");
	count++;

	strCount = count;

	WriteLog("%d°³ÀÇ ÀÎº¥Åä¸® ÄÃ·¯¸µ µ¥ÀÌÅÍ°¡ ÀÖ½À´Ï´Ù.\n", strCount);

	vector<WORD> search;
	vector<WORD> patch1;
	vector<WORD> patch2;
	vector<WORD> patch3;
	vector<WORD> backup1;
	vector<WORD> backup2;
	vector<WORD> backup3;

	search +=
		0xFF, 0xD7,
		0x52,
		0x50,
		0xE8, -1, -1, -1, -1,
		0x83, 0xC4, 0x0C,
		0x84, 0xC0,
		0x74, 0x76;
/*
	patch3 +=
		0xFF, 0xD7,
		0x52,
		0x50,
		0xE8, -1, -1, -1, -1,
		0xE8, 0x01FF, 0x01FF, 0x01FF, 0x01FF,
		0x74, 0x76;
*/
	MemoryPatch mp( NULL, search, search );
	mp.Search( L"Pleione.dll" );
	addrItemColoring = mp.GetAddr() + 0x10;

	// ³»±¸µµ ´ÙçÀ»¶§
	backup1 +=
		0x8B, 0xF8,
		0x85, 0xDB,
		0x0F, 0x84, -1, -1, -1, -1,
		0x85, 0xFF,
		0x0F, 0x84, -1, -1, -1, -1,
		0x8B, 0xCF,
		0xFF, 0x15, -1, -1, -1, -1,
		0x84, 0xC0,
		0x0F, 0x85;

	funcPointer = (LPBYTE)patchInventoryColoring;

	patch1 +=
		0x8B, 0xF8,
		0x85, 0xDB,
		0x0F, 0x84, -1, -1, -1, -1,
		0x85, 0xFF,
		0x0F, 0x84, -1, -1, -1, -1,
		0x8B, 0xCF,
		0xFF, 0x15,
		((int)(&funcPointer) & 0xFF),
		(((int)(&funcPointer) & 0xFF00) >> 8),
		(((int)(&funcPointer) & 0xFF0000) >> 16),
		(((int)(&funcPointer) & 0xFF000000) >> 24),
		0x84, 0xC0,
		0x0F, 0x85;

	MemoryPatch mp1( NULL, patch1, backup1 );
	mp1.Search( L"Pleione.dll" );

	backup2 +=
		0x59,
		0x59,
		0x8B, 0x4D, 0x1C,
		0x89, 0x01,
		0xB8, 0x00, 0x00, 0xA0, 0x00,
		0x09, 0x06,
		0x09, 0x07,
		0xB8, 0x00, 0x00, 0xD0, 0x00,
		0xE9;

	patch2 +=
		0x59,
		0x59,
		0x8B, 0x4D, 0x1C,
		0x89, 0x01,
		0xA1,
		((int)(&Color1) & 0xFF),
		(((int)(&Color1) & 0xFF00) >> 8),
		(((int)(&Color1) & 0xFF0000) >> 16),
		(((int)(&Color1) & 0xFF000000) >> 24),
		0x09, 0x06,
		0x09, 0x07,
		0xA1,
		((int)(&Color2) & 0xFF),
		(((int)(&Color2) & 0xFF00) >> 8),
		(((int)(&Color2) & 0xFF0000) >> 16),
		(((int)(&Color2) & 0xFF000000) >> 24),
		0xE9;

	MemoryPatch mp2( NULL, patch2, backup2 );
	mp2.Search( L"Pleione.dll" );

	backup3 +=
		0x83, 0xBE, 0xAC, 0x00, 0x00, 0x00, 0x04,
		0x74, 0x39,
		0x53,
		0xFF, 0x75, 0xF8,
		0x8D, 0x8E;

	patch3 +=
		0xE8, 0x01FF, 0x01FF, 0x01FF, 0x01FF,
		0x85, 0xC0,
		0x74, 0x39,
		0x53,
		0xFF, 0x75, 0xF8,
		0x8D, 0x8E;

	MemoryPatch mp3( NULL, patch3, backup3 );
	mp3.Search( L"Pleione.dll" );
	mp3.PatchRelativeAddress( 0x01, (LPBYTE)patchIsEnable );

	addrTargetReturn = mp3.GetAddr() + 0x07;
	
	patches += mp1;
	patches += mp2;
	patches += mp3;
	if (CheckPatches())
		WriteLog("ÆÐÄ¡ ÃÊ±âÈ­ ¿Ï·á: %s.\n", patchname.c_str());
	else
		WriteLog("ÆÐÄ¡ ÃÊ±âÈ­ ½ÇÆÐ: %s.\n", patchname.c_str());
}

//-----------------------------------------------------------------------------
// Hook functions

NAKED void CPatcher_InventoryColoring::patchInventoryColoring(void)
{
	if (IsPatchEnabled())
	{
		unsigned long c1;
		unsigned long c2;

		for(int lp=0; lp<strCount; lp++)
		{
			c1 = InvColor[lp].color[0];
			c2 = InvColor[lp].color[1];

			LPBYTE tp = (LPBYTE)&(InvColor[lp].category);

			__asm {
				MOV DWORD PTR DS:[Color1], 0x0A00000
				MOV DWORD PTR DS:[Color2], 0x0D00000

				MOV ECX, EDI
				CALL addrIsBroken
				TEST AL, AL
				JNE IsBroken

				//ColoringItem:

				MOV ECX, EDI
				PUSH DWORD PTR DS:[tp]
				CALL addrCheckFastStringID
				TEST AL, AL
				JNE TargetItem
				MOV BYTE PTR DS:[ColorMOD], 0
			}
		}

		__asm {
			JMP IsBroken
			// ÇØ´çµÇ´Â ¾ÆÀÌÅÛÀÏ¶§
			TargetItem:
			MOV EAX, DWORD PTR DS:[c1]
			MOV DWORD PTR DS:[Color1], EAX
			MOV EAX, DWORD PTR DS:[c2]
			MOV DWORD PTR DS:[Color2], EAX
			MOV BYTE PTR DS:[ColorMOD], 1
		}

		// »öÀÌ ÁöÁ¤µÇÁö ¾Ê¾ÒÀ» ¶© ÆÐ½º	
		if (c1 == 0 && c2 == 0)
		{
			__asm MOV BYTE PTR DS:[ColorMOD], 0
		}

		__asm {

			IsBroken:
			MOV ECX, EDI
			JMP addrIsBroken
		}
	}
	else
	{
		__asm {
			// º¹±¸ÇÏ±â
			MOV ECX, EDI
			MOV DWORD PTR DS:[Color1], 0x0A00000
			MOV DWORD PTR DS:[Color2], 0x0D00000
			MOV BYTE PTR DS:[ColorMOD], 0
			JMP addrIsBroken
		}
	}
}

NAKED void CPatcher_InventoryColoring::patchIsEnable(void)
{
	__asm {
		//ADD ESP, 4h
		PUSH EAX
		/*
		TEST AL, AL
		JE lNext

		// Broke & Expire
		MOV DWORD PTR DS:[Color1], 0x0A00000
		MOV DWORD PTR DS:[Color2], 0x0D00000

		lNext:
		*/
	}

	// ÆÐÄ¡¼³Á¤ÁßÀÌ°í ÀÎº¥Åä¸® ÄÃ·¯¸µ¿¡ °É¸°³à¼®ÀÏ¶§
	if (IsPatchEnabled() && ColorMOD == 1)
	{
		__asm {
			POP EAX
			CMP DWORD PTR DS:[ESI+0xAC],4
			JE lMousePut
			//ADD ESP, 0x0C
			ADD ESP, 0x04
			JMP addrItemColoring
		}
	}
	else
	{
		__asm {
			POP EAX
			lMousePut:
			//ADD ESP, 0x0C
			CMP DWORD PTR DS:[ESI+0xAC],4
			RETN
		}
	}

}
//-----------------------------------------------------------------------------
// ¿À¹ö¶óÀÌµå ÇÔ¼ö

bool CPatcher_InventoryColoring::Uninstall( void ) {
	// ÀÌ ¸ðµå´Â ÇÑ¹ø ¼³Ä¡ÇÏ¸é Á¦°ÅÇÒ ¼ö ¾ø½À´Ï´Ù
	return false;
}

bool CPatcher_InventoryColoring::Toggle( void ) {
	// ÀÌ ¸ðµå´Â ÇÑ¹ø ¼³Ä¡ÇÏ¸é Á¦°ÅÇÒ ¼ö ¾ø½À´Ï´Ù
	return false;
}

//-----------------------------------------------------------------------------
// ÆÐÄ¡ Åä±Û ÇÔ¼ö

bool CPatcher_InventoryColoring::IsPatchEnabled(void)
{
	if (PatchEnabled == true)
		return true;
	else return false;
}

bool CPatcher_InventoryColoring::PatchEnable(void)
{
	PatchEnabled = true;
	return true;
}

bool CPatcher_InventoryColoring::PatchDisable(void)
{
	PatchEnabled = false;
	return true;
}

bool CPatcher_InventoryColoring::PatchToggle(void)
{
	if (IsPatchEnabled())
		PatchDisable();
	else PatchEnable();
	return true;
}
//-----------------------------------------------------------------------------
// INI Functions

bool CPatcher_InventoryColoring::ReadINI( void )
{
	wchar_t buf[256];
	wchar_t name[256];
	wchar_t *endptr = NULL;

	for (int i=0; i<strCount; i++)
	{
		for (int j=1; j<=2; j++)
		{
			swprintf(name, sizeof(name), L"%ls%d", InvColor[i].name, j);
			ReadINI_String(name, buf);
			InvColor[i].color[j-1] = wcstoul(buf, &endptr, 16);
			WriteLog("%ls: #%08X\n", name, InvColor[i].color[j-1]);
		}

	}

	if ( ReadINI_Bool( L"InvColoring" ))
		return PatchEnable();
	return true;
}

bool CPatcher_InventoryColoring::WriteINI( void )
{
	WriteINI_Bool( L"InvColoring", IsPatchEnabled() );
	return true;
}